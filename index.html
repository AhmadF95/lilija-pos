<! -- language selector and initialization snippets -->
<select id="uiLanguage" name="uiLanguage" aria-label="UI language">
  <option value="en" data-i18n="languageNameEn">English</option>
  <option value="ar" data-i18n="languageNameAr">Arabic</option>
</select>

<script>
function initializeLanguage() {
  var lang = 'en';
  try {
    if (typeof getUISettings === 'function') {
      var ui = getUISettings();
      if (ui && ui.language) lang = ui.language;
    }
  } catch (e) { }

  try {
    var ls = localStorage.getItem('pos.lang');
    if (ls) lang = ls;
  } catch (e) { }

  if (typeof applyTranslations === 'function') applyTranslations(lang);
  if (typeof applyUISettings === 'function') applyUISettings();

  var langDropdown = document.getElementById('uiLanguage');
  if (langDropdown) {
    langDropdown.value = lang;
    if (!langDropdown._i18nBound) {
      langDropdown.addEventListener('change', function () {
        var v = this.value;
        try { localStorage.setItem('pos.lang', v); } catch (e) {}
        if (typeof saveUISettings === 'function') {
          try { saveUISettings({ language: v }); } catch (e) {}
        }
        if (typeof applyTranslations === 'function') applyTranslations(v);
        if (typeof applyUISettings === 'function') applyUISettings();
      });
      langDropdown._i18nBound = true;
    }
  }
}

document.addEventListener('DOMContentLoaded', initializeLanguage);
</script>
